<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>个人中心</title>
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/form.css">
</head>
<body>
  <div class="header container">
    个人中心
    <p>
      <a href="./rpwd.html" id="changePwdLink">修改密码</a>
      <a href="./index.html" id="homeLink">回到首页</a>
    </p>
  </div>
  <div id="userProfile" style="display: none;">
    <form id="editProfileForm">
      <label>
        用户名：<input type="text" class="username" disabled>
      </label>
      <label>
        年龄：<input type="text" class="age">
      </label>
      <label>
        性别：<select class='gender'>
          <option value="">请选择</option>
          <option value="男">男</option>
          <option value="女">女</option>
        </select>
      </label>
      <label>
        昵称：<input type="text" class="nickname">
      </label>
      <button type="submit">确认修改</button>
    </form>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      // 检查用户是否已登录
      if (!localStorage.getItem('userLoggedIn')) {
        alert('请先登录！');
        window.location.href = 'login.html'; // 未登录则重定向至登录页面
      } else {
        // 用户已登录，填充表单数据
        var userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
        $('#userProfile').show();
        $('.username').val(userInfo.username || '');
        $('.age').val(userInfo.age || '');
        $('.gender').val(userInfo.gender || '');
        $('.nickname').val(userInfo.nickname || '');
      }

      $('#editProfileForm').submit(function(event) {
        event.preventDefault();
        var age = $('.age').val();
        var gender = $('.gender').val();
        var nickname = $('.nickname').val();

        // 确保所有字段都被填写
        if (!age || !gender || !nickname) {
          alert('请确保所有字段都填写完整！');
          return;
        }

        // 更新用户信息并保存至localStorage
        var updatedUserInfo = { ...userInfo, age, gender, nickname };
        localStorage.setItem('userInfo', JSON.stringify(updatedUserInfo));
        alert('用户信息修改成功！');
        // Optionally refresh the page or redirect
      });
    });
  </script>
</body>
</html>
